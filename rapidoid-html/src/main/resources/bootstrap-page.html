<!DOCTYPE html>
<html lang="en">
<head>

<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>{{title}}</title>

<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>

<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet">

<script>
var theme;
try {
  var m = /\bTHEME=(\w+?)\b/g.exec(document.cookie);
  theme = m[1];
} catch (e) { }
if (theme && theme != 'default') {
document.write('<link href="//maxcdn.bootstrapcdn.com/bootswatch/3.3.0/' + theme + '/bootstrap.min.css" rel="stylesheet">');
}
</script>

<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

<style type="text/css">
{{style}}
</style>

<script>
function _modal(title, content) {
	$('#_modal_title').html(title);
	$('#_modal_body').html(content);
	$('#_modal_box').modal({});
}
function _emit(c, event) {

	var x = document.querySelectorAll("input,textarea");

	var inputs = {};

	for (var i = 0; i < x.length; i++) {
		var t = $(x[i]);
		var _h = t.attr('_h');

		var val;

		if (t.prop('type') == 'checkbox' || t.prop('type') == 'radio') {
			val = t.prop('checked');
		} else {
			val = t.val();
		}

		inputs[_h] = val;
	}

	x = document.querySelectorAll("option");

	for (var i = 0; i < x.length; i++) {
		var t = $(x[i]);
		var _h = t.attr('_h');

		inputs[_h] = t.prop('selected');
	}

	var hnd = $(c).attr('_h');

	$.post('/_emit', {
		event : event,
		hnd : hnd,
		inputs : JSON.stringify(inputs)
	}).done(function(data) {
		for ( var h in data) {
			$('[_h=' + h + ']').replaceWith(data[h]);
		}
	}).fail(function(data) {
		alert("Communication error!");
		console.log(data);
	});
}
</script>

{{head}}
</head>

<body>

{{body}}

<div id="_modal_box" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 id="_modal_title" class="modal-title"></h4>
      </div>
      <div id="_modal_body" class="modal-body"></div>
      <div id="_modal_footer" class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

</body>
</html>
